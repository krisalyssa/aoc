#!/usr/bin/env bash

##
## main command for aoc
##

AOC_ROOT="$(dirname "$0")/.."

usage() {
    echo "usage: aoc <command> [params]"
    echo "       aoc -h"
    echo "       aoc commands  # for all commands"
}

while getopts ":h" opt; do
    case ${opt} in
        h) # help
            usage 0
            ;;

        \?)
            echo "invalid option -${OPTARG}" 1>&2
            usage
            ;;

        :)
            echo "option ${OPTARG} requires an argument" 1>&2
            usage
            ;;

        *) ;;
    esac
done
shift $((OPTIND - 1))

AOC_COMMAND=$1
shift 1

if [[ -z "${AOC_COMMAND}" ]]; then
    usage
    exit 1
elif [[ "${AOC_COMMAND}" == "commands" ]]; then
    usage
    echo "available commands:"

    for c in "${AOC_ROOT}"/bin/aoc-*; do
        [[ -e "${c}" ]] || break
        echo "  ${c##"${AOC_ROOT}"/bin/aoc-}"
    done

    exit 1
else
    SCRIPT_FILENAME="${AOC_ROOT}/bin/aoc-${AOC_COMMAND}"
    if [[ ! -x "${SCRIPT_FILENAME}" ]]; then
        echo "unknown command '${AOC_COMMAND}'"
        usage
    fi

    ${SCRIPT_FILENAME} "$@"
fi
