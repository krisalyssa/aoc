#!/bin/bash

usage() {
        echo "usage: test" 2>&1
        exit 1
}

DAY=$1
[[ -z ${DAY} ]] && usage

shift 1

cd /aoc/src || exit 1

# NOTE: this directory depends on the Elixir and Erlang versions in the image!
[[ ! -d /home/aoc/.mix/archives/hex-2.3.1-otp-28 ]] && mix local.hex --force

if [[ ! -r mix.lock ]]; then
        # shellcheck disable=SC1010
        mix do deps.get, deps.compile
fi

mix test "test/aoc/day_${DAY}_test.exs"
